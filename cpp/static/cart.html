<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="images/favicon.ico" rel="icon" type="image/x-icon">
    <title>购物车</title>

    <!-- 关键 CSS -->
    <link href="css/styles.css" rel="stylesheet">
    <link href="fonts/remixicon.css" rel="stylesheet">

    <!-- 非关键 CSS 预加载 -->
    <link as="style" href="css/modal.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload">
    <link as="style" href="css/alert.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload">
    <noscript>
        <link href="css/modal.css" rel="stylesheet">
        <link href="css/alert.css" rel="stylesheet">
    </noscript>
</head>
<body>
<div class="container">
    <header class="header-container">
        <div>
            <h2>购物车</h2>
        </div>
        <div class="header-buttons">
            <button class="header-button" id="switchAccountButton" style="display: none;" type="button">
                <i class="ri-user-shared-line"></i>
                切换账号
            </button>
            <button class="header-button" id="loginButton" type="button">
                <i class="ri-login-circle-line"></i>
                登录
            </button>
        </div>
    </header>

    <!-- 用户信息显示区域 -->
    <div class="user-info-container" id="userInfoContainer" style="display: none;">
        <div class="user-info-card">
            <img alt="用户头像" class="user-avatar" id="userAvatar" src="">
            <div class="user-details">
                <div class="user-name" id="userName">未知</div>
                <div class="user-meta">
                    <span id="userPhone">未知</span>
                    <span class="separator">|</span>
                    <span id="userSex">未知</span>
                    <span class="separator">|</span>
                    <span id="userProvince">未知</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie显示区域 -->
    <div class="form-group">
        <label for="cookies">Cookie:</label>
        <div class="input-with-button">
            <input id="cookies" placeholder="Cookie信息将在这里显示" readonly type="text">
            <button class="copy-button" onclick="copyCookieToClipboard()">
                <i class="ri-file-copy-line"></i>
                复制
            </button>
        </div>
    </div>

    <!-- 购物车内容区域 -->
    <div id="cartContent">
        <div id="shopList">
            <!-- 购物车内容将在这里显示 -->
        </div>
    </div>

    <!-- 底部固定操作栏 -->
    <div class="cart-bottom-bar">
        <div class="select-all">
            <input id="selectAll" onchange="handleSelectAll()" type="checkbox">
            <label for="selectAll">全选</label>
        </div>
        <button class="generate-btn" onclick="generateOrderLink()">
            <i class="ri-shopping-cart-line"></i>
            生成订单
        </button>
    </div>
</div>

<!-- 底部导航栏 -->
<footer class="footer-nav">
    <a href="index.html">
        <i class="ri-add-circle-line"></i>
        <span>提交</span>
    </a>
    <a class="active" href="cart.html">
        <i class="ri-shopping-cart-line"></i>
        <span>购物车</span>
    </a>
    <a href="requests.html">
        <i class="ri-list-check-2"></i>
        <span>任务</span>
    </a>
    <a href="results.html">
        <i class="ri-file-list-3-line"></i>
        <span>结果</span>
    </a>
    <a href="user.html">
        <i class="ri-user-3-line"></i>
        <span>我的</span>
    </a>
</footer>

<!-- 自定义提示框 -->
<div class="custom-alert" id="customAlert"></div>

<!-- 遮罩层 -->
<div class="modal-overlay" id="modalOverlay"></div>

<!-- 登录模态框 -->
<div class="modal" id="loginModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>登录</h2>
            <button class="close-button" onclick="closeLoginModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- 登录方式切换 -->
            <div class="login-type-switch">
                <button class="switch-btn active" id="phoneLoginBtn" onclick="switchLoginType('phone')">手机登录
                </button>
                <button class="switch-btn" id="cookieLoginBtn" onclick="switchLoginType('cookie')">Cookie登录</button>
            </div>

            <!-- 手机号登录表单 -->
            <div id="phoneLoginForm">
                <div class="form-group">
                    <label for="countryCode">区号:</label>
                    <div class="country-code-input">
                        <span class="prefix">+</span>
                        <input id="countryCode" placeholder="输入区号" type="text" value="86">
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone">手机号:</label>
                    <input id="phone" placeholder="请输入手机号" type="text">
                </div>
                <div class="form-group">
                    <label for="vcode">验证码:</label>
                    <input id="vcode" placeholder="请输入验证码" type="text">
                </div>
            </div>

            <!-- Cookie登录表单 -->
            <div id="cookieLoginForm" style="display: none;">
                <div class="form-group">
                    <label for="loginCookie">Cookie:</label>
                    <textarea id="loginCookie" placeholder="请输入Cookie" rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-button primary" onclick="handleLogin()">
                <i class="ri-check-line"></i>
                确认
            </button>
            <button class="modal-button secondary" onclick="closeLoginModal()">
                <i class="ri-close-line"></i>
                取消
            </button>
        </div>
    </div>
</div>

<!-- 订单链接模态框 -->
<div class="modal" id="orderLinkModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>订单链接</h2>
            <button class="close-button" onclick="closeOrderLinkModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="orderLink">生成的订单链接:</label>
                <input id="orderLink" readonly type="text">
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-button primary" onclick="copyOrderLink()">
                <i class="ri-file-copy-line"></i>
                复制链接
            </button>
            <button class="modal-button secondary" onclick="closeOrderLinkModal()">
                <i class="ri-close-line"></i>
                关闭
            </button>
        </div>
    </div>
</div>

<!-- 账号切换模态框 -->
<div class="modal" id="accountSwitchModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>切换账号</h2>
            <button class="close-button" onclick="closeAccountSwitchModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="account-list" id="accountList">
                <!-- 账号列表将在这里显示 -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-button secondary" onclick="closeAccountSwitchModal()">
                <i class="ri-close-line"></i>
                关闭
            </button>
        </div>
    </div>
</div>

<!-- 订单详情模态框 -->
<div class="modal" id="orderDetailsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>订单详情</h2>
            <button class="close-button" onclick="closeOrderDetailsModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="modal-body" id="orderDetailsContent">
            <!-- 内容将通过 JavaScript 动态填充 -->
        </div>
        <div class="modal-footer">
            <button class="modal-button secondary" onclick="closeOrderDetailsModal()">
                <i class="ri-close-line"></i>
                关闭
            </button>
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 16px;
        padding-bottom: 80px;
    }

    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .header-container h2 {
        font-size: 20px;
        font-weight: 500;
        color: #333;
        margin: 0;
    }

    .header-button {
        background: transparent;
        border: 1px solid #e5e7eb;
        color: #374151;
        padding: 8px 16px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .header-button:hover {
        background: #f3f4f6;
    }

    .form-group {
        margin-bottom: 16px;
        background: #f9fafb;
        padding: 12px;
        border-radius: 8px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #374151;
        font-size: 14px;
    }

    .form-group input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: #fff;
    }

    .shop-card {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .shop-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 12px;
    }

    .shop-logo {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        object-fit: cover;
    }

    .shop-name {
        font-size: 15px;
        font-weight: 500;
        color: #374151;
        flex: 1;
    }

    .promotion-info {
        background: #fef2f2;
        color: #ef4444;
        padding: 8px 12px;
        font-size: 13px;
        border-radius: 6px;
        margin: 12px 0;
    }

    .item-list {
        margin-top: 12px;
    }

    .item-card {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .item-card:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .item-checkbox {
        width: 20px;
        height: 20px;
        margin: 0;
        margin-top: 30px;
        cursor: pointer;
        position: relative;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: 2px solid #d1d5db;
        border-radius: 50%;
        background-color: #fff;
        transition: all 0.2s;
        flex-shrink: 0;
    }

    .item-checkbox:hover {
        border-color: #3b82f6;
    }

    .item-checkbox:checked {
        background-color: #3b82f6;
        border-color: #3b82f6;
    }

    .item-checkbox:checked::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 5px;
        height: 9px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: translate(-50%, -65%) rotate(45deg);
    }

    .item-image {
        width: 80px;
        height: 80px;
        border-radius: 6px;
        object-fit: cover;
        background: #f3f4f6;
    }

    .item-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 0;
    }

    .item-name {
        font-size: 14px;
        color: #374151;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.5;
    }

    .item-sku {
        font-size: 12px;
        color: #6b7280;
        padding: 4px 8px;
        background: #f3f4f6;
        border-radius: 4px;
        display: inline-block;
    }

    .item-price {
        color: #ef4444;
        font-size: 16px;
        font-weight: 500;
        display: flex;
        align-items: baseline;
        gap: 4px;
    }

    .item-original-price {
        color: #9ca3af;
        font-size: 12px;
        text-decoration: line-through;
        font-weight: normal;
    }

    .item-status {
        font-size: 12px;
        color: #ef4444;
        background: #fef2f2;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .item-status i {
        font-size: 14px;
    }

    .item-count {
        font-size: 13px;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .cart-bottom-bar {
        position: fixed;
        bottom: 74px;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        padding: 12px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top: 1px solid rgba(229, 231, 235, 0.5);
        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        z-index: 1001;
    }

    .select-all {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .select-all input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin: 0;
        cursor: pointer;
        position: relative;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: 2px solid #d1d5db;
        border-radius: 50%;
        background-color: #fff;
        transition: all 0.2s;
        flex-shrink: 0;
    }

    .select-all input[type="checkbox"]:hover {
        border-color: #3b82f6;
    }

    .select-all input[type="checkbox"]:checked {
        background-color: #3b82f6;
        border-color: #3b82f6;
    }

    .select-all input[type="checkbox"]:checked::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 5px;
        height: 9px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: translate(-50%, -65%) rotate(45deg);
    }

    .select-all label {
        font-size: 14px;
        color: #374151;
        cursor: pointer;
    }

    .generate-btn {
        background: #ef4444;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
    }

    .generate-btn:hover {
        background: #dc2626;
    }

    .link-container {
        display: flex;
        gap: 8px;
    }

    .link-container input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: #fff;
    }

    .link-container button {
        background: #3b82f6;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
    }

    .link-container button:hover {
        background: #2563eb;
    }

    .empty-cart {
        text-align: center;
        padding: 32px 16px;
        color: #6b7280;
        font-size: 14px;
    }

    .user-info-container {
        margin-bottom: 16px;
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
    }

    .user-info-card {
        display: flex;
        align-items: center;
        padding: 16px;
        gap: 16px;
    }

    .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        background: #f3f4f6;
    }

    .user-details {
        flex: 1;
    }

    .user-name {
        font-size: 16px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 4px;
    }

    .user-meta {
        font-size: 13px;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .separator {
        color: #d1d5db;
    }

    .login-type-switch {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        background: #f3f4f6;
        padding: 4px;
        border-radius: 6px;
    }

    .switch-btn {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 4px;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
    }

    .switch-btn.active {
        background: #fff;
        color: #3b82f6;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .form-group textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: #fff;
        resize: vertical;
        min-height: 80px;
    }

    .country-code-input {
        display: flex;
        align-items: center;
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
        width: 100%;
    }

    .country-code-input .prefix {
        padding: 8px 4px 8px 12px;
        color: #374151;
        font-size: 14px;
        background: #f3f4f6;
        border-right: 1px solid #e5e7eb;
    }

    .country-code-input input {
        border: none !important;
        padding: 8px 12px !important;
        width: 100% !important;
        font-size: 14px;
    }

    .country-code-input input:focus {
        outline: none;
    }

    .header-buttons {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .account-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .account-item {
        display: flex;
        align-items: center;
        padding: 12px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .account-item:hover {
        background: #f3f4f6;
        border-color: #3b82f6;
    }

    .account-item.active {
        background: #ebf5ff;
        border-color: #3b82f6;
    }

    .account-item .account-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 12px;
    }

    .account-item .account-info {
        flex: 1;
    }

    .account-item .account-name {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 4px;
    }

    .account-item .account-phone {
        font-size: 12px;
        color: #6b7280;
    }

    .account-item .account-actions {
        display: flex;
        gap: 8px;
    }

    .account-item .account-action-btn {
        padding: 4px 8px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .account-item .switch-btn {
        background: #3b82f6;
        color: #fff;
    }

    .account-item .switch-btn:hover {
        background: #2563eb;
    }

    .account-item .delete-btn {
        background: #ef4444;
        color: #fff;
    }

    .account-item .delete-btn:hover {
        background: #dc2626;
    }

    @media (prefers-color-scheme: dark) {
        body {
            background: #111827;
            color: #e5e7eb;
        }

        .container {
            background: #111827;
        }

        .header-container h2 {
            color: #e5e7eb;
        }

        .header-button {
            background: #1f2937;
            border-color: #374151;
            color: #e5e7eb;
        }

        .header-button:hover {
            background: #374151;
        }

        .form-group {
            background: #1f2937;
        }

        .form-group label {
            color: #e5e7eb;
        }

        .form-group input {
            background: #111827;
            border-color: #374151;
            color: #e5e7eb;
        }

        .shop-card {
            background: #1f2937;
            border-color: #374151;
        }

        .shop-header {
            border-bottom-color: #374151;
        }

        .shop-name {
            color: #e5e7eb;
        }

        .item-card {
            border-bottom-color: #374151;
        }

        .item-checkbox,
        .select-all input[type="checkbox"] {
            border-color: #4b5563;
            background-color: #1f2937;
        }

        .item-checkbox:hover,
        .select-all input[type="checkbox"]:hover {
            border-color: #3b82f6;
        }

        .item-checkbox:checked,
        .select-all input[type="checkbox"]:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .item-name {
            color: #e5e7eb;
        }

        .item-sku {
            background: #374151;
            color: #9ca3af;
        }

        .item-count {
            color: #9ca3af;
        }

        .cart-bottom-bar {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-top-color: rgba(55, 65, 81, 0.5);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        .select-all label {
            color: #e5e7eb;
        }

        .link-container input {
            background: #111827;
            border-color: #374151;
            color: #e5e7eb;
        }

        .user-info-container {
            background: #1f2937;
            border-color: #374151;
        }

        .user-avatar {
            background: #374151;
        }

        .user-name {
            color: #e5e7eb;
        }

        .user-meta {
            color: #9ca3af;
        }

        .separator {
            color: #4b5563;
        }

        .login-type-switch {
            background: #374151;
        }

        .switch-btn {
            color: #9ca3af;
        }

        .switch-btn.active {
            background: #1f2937;
            color: #3b82f6;
        }

        .form-group textarea {
            background: #111827;
            border-color: #374151;
            color: #e5e7eb;
        }

        .account-item {
            background: #1f2937;
            border-color: #374151;
        }

        .account-item:hover {
            background: #374151;
            border-color: #3b82f6;
        }

        .account-item.active {
            background: #1e3a8a;
            border-color: #3b82f6;
        }

        .account-item .account-name {
            color: #e5e7eb;
        }

        .account-item .account-phone {
            color: #9ca3af;
        }
    }

    .input-with-button {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .input-with-button input {
        flex: 1;
    }

    .copy-button {
        background: #3b82f6;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        height: 36px;
    }

    .copy-button:hover {
        background: #2563eb;
    }

    .address-card {
        background: #f9fafb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .address-card h3 {
        margin: 0 0 8px 0;
        font-size: 16px;
        color: #374151;
    }

    .address-info p {
        margin: 4px 0;
        color: #6b7280;
        font-size: 14px;
    }

    .invalid-items-section,
    .valid-items-section {
        margin-bottom: 24px;
    }

    .invalid-items-section h3,
    .valid-items-section h3 {
        margin: 0 0 16px 0;
        font-size: 16px;
        color: #374151;
    }

    .shop-card.invalid {
        border-color: #ef4444;
        background: #fef2f2;
    }

    .shop-total {
        font-size: 14px;
        color: #ef4444;
    }

    .discount-tag {
        background: #fef2f2;
        color: #ef4444;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
        margin-left: 8px;
    }

    .order-total {
        border-top: 1px solid #e5e7eb;
        padding-top: 16px;
        margin-top: 16px;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
        color: #6b7280;
    }

    .total-row.highlight {
        color: #ef4444;
        font-weight: 500;
        font-size: 16px;
    }

    @media (prefers-color-scheme: dark) {
        .address-card {
            background: #1f2937;
        }

        .address-card h3 {
            color: #e5e7eb;
        }

        .address-info p {
            color: #9ca3af;
        }

        .invalid-items-section h3,
        .valid-items-section h3 {
            color: #e5e7eb;
        }

        .shop-card.invalid {
            background: #991b1b;
            border-color: #ef4444;
        }

        .order-total {
            border-top-color: #374151;
        }

        .total-row {
            color: #9ca3af;
        }
    }

    /* 添加订单数据输入框样式 */
    .order-data-container {
        margin-bottom: 16px;
        background: #f9fafb;
        padding: 12px;
        border-radius: 8px;
    }

    .order-data-container label {
        display: block;
        margin-bottom: 8px;
        color: #374151;
        font-size: 14px;
        font-weight: 500;
    }

    .order-data-container input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: #fff;
        color: #374151;
        cursor: text;
    }

    @media (prefers-color-scheme: dark) {
        .order-data-container {
            background: #1f2937;
        }

        .order-data-container label {
            color: #e5e7eb;
        }

        .order-data-container input {
            background: #111827;
            border-color: #374151;
            color: #e5e7eb;
        }
    }
</style>

<script>
    // 页面加载时检查登录状态并获取购物车数据
    document.addEventListener('DOMContentLoaded', async function () {
        const savedCookie = localStorage.getItem('cartCookie');
        const savedAccounts = JSON.parse(localStorage.getItem('savedAccounts') || '[]');

        if (savedCookie) {
            document.getElementById('cookies').value = savedCookie;
            updateLoginButton(true);
            await fetchCartData(savedCookie);
            await fetchUserInfo(savedCookie);
        } else {
            updateLoginButton(false);
        }

        // 更新切换账号按钮显示状态
        updateSwitchAccountButton(savedAccounts.length > 0);

        // 初始化点击事件监听
        document.getElementById('modalOverlay').addEventListener('click', function (e) {
            if (e.target === this) {
                closeAllModals();
            }
        });

        // 初始化切换账号按钮点击事件
        document.getElementById('switchAccountButton').addEventListener('click', showAccountSwitchModal);
    });

    // 更新登录按钮状态
    function updateLoginButton(isLoggedIn) {
        const loginButton = document.getElementById('loginButton');
        if (isLoggedIn) {
            loginButton.innerHTML = '<i class="ri-logout-circle-line"></i>退出登录';
            loginButton.onclick = handleLogout;
        } else {
            loginButton.innerHTML = '<i class="ri-login-circle-line"></i>登录';
            loginButton.onclick = showLoginModal;
        }
    }

    // 显示登录模态框
    function showLoginModal() {
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('loginModal').style.display = 'block';
        // 重置表单
        document.getElementById('countryCode').value = '86';
        document.getElementById('phone').value = '';
        document.getElementById('vcode').value = '';
        document.getElementById('loginCookie').value = '';
        // 默认显示手机号登录
        switchLoginType('phone');
    }

    // 关闭登录模态框
    function closeLoginModal() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('loginModal').style.display = 'none';
    }

    // 切换登录方式
    function switchLoginType(type) {
        const phoneForm = document.getElementById('phoneLoginForm');
        const cookieForm = document.getElementById('cookieLoginForm');
        const phoneBtn = document.getElementById('phoneLoginBtn');
        const cookieBtn = document.getElementById('cookieLoginBtn');

        if (type === 'phone') {
            phoneForm.style.display = 'block';
            cookieForm.style.display = 'none';
            phoneBtn.classList.add('active');
            cookieBtn.classList.remove('active');
        } else {
            phoneForm.style.display = 'none';
            cookieForm.style.display = 'block';
            phoneBtn.classList.remove('active');
            cookieBtn.classList.add('active');
        }
    }

    // 处理登录请求
    async function handleLogin() {
        const phoneForm = document.getElementById('phoneLoginForm');

        if (phoneForm.style.display === 'block') {
            // 手机号登录
            const phone = document.getElementById('phone').value;
            const countryCode = document.getElementById('countryCode').value;
            const vcode = document.getElementById('vcode').value;

            try {
                const response = await fetch('/api/loginbyvcode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        phone,
                        countryCode,
                        vcode
                    })
                });

                const data = await response.json();

                if (data.status.status_code === 0) {
                    // 登录成功
                    const cookieStr = data.result.cookie
                        .map(cookie => `${cookie.name}=${cookie.value}`)
                        .join(';');

                    handleLoginSuccess(cookieStr);
                } else {
                    // 登录失败
                    showAlert('error', data.status.status_reason);
                }
            } catch (error) {
                console.error('登录请求失败:', error);
                showAlert('error', '登录请求失败，请稍后重试');
            }
        } else {
            // Cookie登录
            const cookieStr = document.getElementById('loginCookie').value.trim();
            if (!cookieStr) {
                showAlert('error', '请输入Cookie');
                return;
            }
            handleLoginSuccess(cookieStr);
        }
    }

    // 处理登录成功
    async function handleLoginSuccess(cookieStr) {
        document.getElementById('cookies').value = cookieStr;
        localStorage.setItem('cartCookie', cookieStr);
        updateLoginButton(true);
        closeLoginModal();

        // 获取用户信息并保存账号
        try {
            const response = await fetch('/api/getUserInfo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    cookie: cookieStr
                })
            });

            const data = await response.json();

            if (data.status.code === 0 && data.status.message === 'OK') {
                const result = data.result;
                const basic = result.basic || {};
                const phone = result.phone || {};

                // 保存账号信息
                const savedAccounts = JSON.parse(localStorage.getItem('savedAccounts') || '[]');
                const existingAccountIndex = savedAccounts.findIndex(account => account.cookie === cookieStr);

                const accountInfo = {
                    cookie: cookieStr,
                    nickname: basic.nickName,
                    phone: phone.telephone,
                    avatar: basic.headImage
                };

                if (existingAccountIndex !== -1) {
                    // 更新现有账号信息
                    savedAccounts[existingAccountIndex] = accountInfo;
                } else {
                    // 添加新账号
                    savedAccounts.push(accountInfo);
                }

                localStorage.setItem('savedAccounts', JSON.stringify(savedAccounts));
                updateSwitchAccountButton(true);
            }
        } catch (error) {
            console.error('保存账号信息失败:', error);
        }

        showAlert('success', '登录成功');
        await fetchCartData(cookieStr);
        await fetchUserInfo(cookieStr);
    }

    // 处理退出登录
    function handleLogout() {
        localStorage.removeItem('cartCookie');
        document.getElementById('cookies').value = '';
        updateLoginButton(false);
        document.getElementById('userInfoContainer').style.display = 'none';
        document.getElementById('shopList').innerHTML = '<div class="empty-cart">购物车是空的</div>';
        showAlert('success', '已退出登录');
    }

    // 获取购物车数据
    async function fetchCartData(cookie) {
        try {
            const response = await fetch('/api/getListCart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    cookie: cookie
                })
            });

            const data = await response.json();

            if (data.status.code === 0) {
                renderCartData(data.result);
            } else {
                showAlert('error', '获取购物车数据失败');
            }
        } catch (error) {
            console.error('获取购物车数据失败:', error);
            showAlert('error', '获取购物车数据失败，请稍后重试');
        }
    }

    // 获取用户信息
    async function fetchUserInfo(cookie) {
        try {
            const response = await fetch('/api/getUserInfo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    cookie: cookie
                })
            });

            const data = await response.json();

            if (data.status.code === 0 && data.status.message === 'OK') {
                const result = data.result;
                const basic = result.basic || {};
                const phone = result.phone || {};
                const wechat = result.wechat || {};

                // 更新用户信息显示
                document.getElementById('userName').textContent = basic.nickName || '未知';
                document.getElementById('userPhone').textContent = phone.telephone || '未知';
                document.getElementById('userSex').textContent = wechat.sex || '未知';
                document.getElementById('userProvince').textContent = wechat.province || '未知';

                if (basic.headImage) {
                    document.getElementById('userAvatar').src = basic.headImage;
                } else {
                    document.getElementById('userAvatar').src = 'images/default-avatar.png';
                }

                document.getElementById('userInfoContainer').style.display = 'block';
            } else {
                showAlert('error', '获取用户信息失败');
            }
        } catch (error) {
            console.error('获取用户信息失败:', error);
            showAlert('error', '获取用户信息失败，请稍后重试');
        }
    }

    // 选中的商品列表
    let selectedItems = [];

    // 处理全选
    function handleSelectAll() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('.item-checkbox');

        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
            const itemData = JSON.parse(checkbox.dataset.item);

            if (selectAllCheckbox.checked) {
                // 添加到选中列表
                if (!selectedItems.find(item => item.itemId === itemData.itemId && item.skuId === itemData.skuId)) {
                    selectedItems.push(itemData);
                }
            } else {
                // 从选中列表中移除
                selectedItems = selectedItems.filter(item =>
                    !(item.itemId === itemData.itemId && item.skuId === itemData.skuId)
                );
            }
        });
    }

    // 处理单个商品选择
    function handleItemSelect(checkbox) {
        const itemData = JSON.parse(checkbox.dataset.item);

        if (checkbox.checked) {
            if (!selectedItems.find(item => item.itemId === itemData.itemId && item.skuId === itemData.skuId)) {
                selectedItems.push(itemData);
            }
        } else {
            selectedItems = selectedItems.filter(item =>
                !(item.itemId === itemData.itemId && item.skuId === itemData.skuId)
            );
        }

        // 更新全选状态
        const checkboxes = document.querySelectorAll('.item-checkbox');
        const selectAllCheckbox = document.getElementById('selectAll');
        selectAllCheckbox.checked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
    }

    // 生成订单链接
    async function generateOrderLink() {
        if (selectedItems.length === 0) {
            showAlert('error', '请选择至少一个商品');
            return;
        }

        const itemsParam = selectedItems.map(item =>
            `${item.itemId}_${item.count}_1_${item.skuId}`
        ).join(',');

        const orderLink = `https://weidian.com/buy/add-order/index.php?items=${itemsParam}&page_name=&source_id=f5c9421654e92902b742e7037fd4626e`;

        // 获取用户信息
        const userName = document.getElementById('userName').textContent;
        const userPhone = document.getElementById('userPhone').textContent;
        const cookie = document.getElementById('cookies').value;

        // 构建JSON数据
        const orderData = {
            userInfo: {
                nickName: userName,
                telephone: userPhone
            },
            orderUrl: orderLink,
            cookie: cookie
        };

        try {
            // 调用代理接口获取订单数据
            const response = await fetch('/api/getAddOrderData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    cookie: cookie,
                    link: orderLink
                })
            });

            const data = await response.json();
            console.log('订单数据响应:', data);

            if (data.order?.status?.code === 0) {
                const result = data.order.result;
                showOrderDetailsModal(result);
            } else {
                showAlert('error', '获取订单数据失败');
            }

            // 复制到剪贴板
            copyToClipboard(JSON.stringify(orderData));
            showAlert('success', '订单信息已复制到剪贴板');
        } catch (error) {
            console.error('获取订单数据失败:', error);
            showAlert('error', '获取订单数据失败，但订单信息已复制到剪贴板');

            // 即使接口调用失败，仍然复制基本订单信息
            copyToClipboard(JSON.stringify(orderData));
        }
    }

    // 显示订单详情模态框
    function showOrderDetailsModal(orderData) {
        const modal = document.getElementById('orderDetailsModal');
        const modalContent = document.getElementById('orderDetailsContent');

        // 获取用户信息
        const userName = document.getElementById('userName').textContent;
        const userPhone = document.getElementById('userPhone').textContent;
        const cookie = document.getElementById('cookies').value;

        // 构建订单数据
        const orderDataObj = {
            userInfo: {
                nickName: userName,
                telephone: userPhone
            },
            orderUrl: `https://weidian.com/buy/add-order/index.php?items=${selectedItems.map(item =>
                `${item.itemId}_${item.count}_1_${item.skuId}`).join(',')}&page_name=&source_id=f5c9421654e92902b742e7037fd4626e`,
            cookie: cookie
        };

        let html = '';

        // 添加订单数据输入框
        html += `
            <div class="form-group order-data-container">
                <label for="orderDataInput">订单数据:</label>
                <div class="input-with-button">
                    <input id="orderDataInput" type="text" value='${JSON.stringify(orderDataObj)}' readonly>
                    <button class="copy-button" onclick="copyOrderData()">
                        <i class="ri-file-copy-line"></i>
                        复制
                    </button>
                </div>
            </div>
        `;

        // 收货地址信息
        if (orderData.buyer_address) {
            const address = orderData.buyer_address;
            html += `
                <div class="address-card">
                    <h3>收货地址</h3>
                    <div class="address-info">
                        <p><strong>${address.buyer_name}</strong> ${address.phone}</p>
                        <p>${address.address_str}</p>
                    </div>
                </div>
            `;
        }

        // 无效商品信息 - 优先使用 invalid_shop_list
        if (orderData.invalid_shop_list?.length > 0) {
            html += '<div class="invalid-items-section"><h3>无效商品</h3>';
            orderData.invalid_shop_list.forEach(shop => {
                html += `
                    <div class="shop-card invalid">
                        <div class="shop-header">
                            <h4>${shop.shop?.shop_name || `店铺ID: ${shop.shop?.shop_id}`}</h4>
                        </div>
                        <div class="item-list">
                `;

                shop.invalid_item_list.forEach(item => {
                    html += generateInvalidItemHtml(item);
                });

                html += '</div></div>';
            });
            html += '</div>';
        }
        // 如果没有 invalid_shop_list 但有 invalid_item_list，则使用 invalid_item_list
        else if (orderData.invalid_item_list?.length > 0) {
            html += '<div class="invalid-items-section"><h3>无效商品</h3>';
            html += `
                <div class="shop-card invalid">
                    <div class="shop-header">
                        <h4>无效商品</h4>
                    </div>
                    <div class="item-list">
            `;

            orderData.invalid_item_list.forEach(item => {
                html += generateInvalidItemHtml(item);
            });

            html += '</div></div></div>';
        }

        // 有效商品信息
        if (orderData.shop_list?.length > 0) {
            html += '<div class="valid-items-section"><h3>有效商品</h3>';
            orderData.shop_list.forEach(shop => {
                html += `
                    <div class="shop-card">
                        <div class="shop-header">
                            <h4>${shop.shop.shop_name}</h4>
                            <div class="shop-total">
                                总计: ¥${shop.total_pay_price}
                                ${shop.express_list?.[0]?.express_fee ?
                    `(含运费: ¥${shop.express_list[0].express_fee})` :
                    '(包邮)'}
                            </div>
                        </div>
                        <div class="item-list">
                `;

                shop.item_list.forEach(item => {
                    html += generateValidItemHtml(item);
                });

                html += '</div></div>';
            });
            html += '</div>';
        }

        // 订单总计信息
        if (orderData.total_price_no_item_pro) {
            html += `
                <div class="order-total">
                    <div class="total-row">
                        <span>商品总价</span>
                        <span>¥${orderData.total_price_no_item_pro}</span>
                    </div>
                    ${orderData.total_save_price ? `
                        <div class="total-row">
                            <span>优惠金额</span>
                            <span>-¥${orderData.total_save_price}</span>
                        </div>
                    ` : ''}
                    ${orderData.total_pay_price ? `
                        <div class="total-row highlight">
                            <span>应付金额</span>
                            <span>¥${orderData.total_pay_price}</span>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        modalContent.innerHTML = html;
        document.getElementById('modalOverlay').style.display = 'block';
        modal.style.display = 'block';
    }

    // 生成无效商品HTML
    function generateInvalidItemHtml(item) {
        return `
                <div class="item-card">
                    <img src="${item.item_head_img}" alt="${item.item_name}" class="item-image">
                    <div class="item-info">
                        <div class="item-name">${item.item_name}</div>
                        <div class="item-price">¥${item.price}</div>
                        <div class="item-status error">
                            <i class="ri-error-warning-line"></i>
                            ${item.reason || '商品无效'}
                        </div>
                        <div class="item-quantity">数量: ${item.quantity}</div>
                    </div>
                </div>
            `;
    }

    // 生成有效商品HTML
    function generateValidItemHtml(item) {
        return `
                <div class="item-card">
                    <img src="${item.item_head_img}" alt="${item.item_name}" class="item-image">
                    <div class="item-info">
                        <div class="item-name">${item.item_name}</div>
                        ${item.item_sku_title ?
            `<div class="item-sku">${item.item_sku_title}</div>` :
            ''}
                        <div class="item-price">
                            ¥${item.price}
                            ${item.item_discount_desc ?
            `<span class="discount-tag">${item.item_discount_desc}</span>` :
            ''}
                        </div>
                        <div class="item-quantity">数量: ${item.quantity}</div>
                    </div>
                </div>
            `;
    }

    // 关闭订单详情模态框
    function closeOrderDetailsModal() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('orderDetailsModal').style.display = 'none';
    }

    // 关闭订单链接模态框
    function closeOrderLinkModal() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('orderLinkModal').style.display = 'none';
    }

    // 复制订单链接
    function copyOrderLink() {
        const orderLink = document.getElementById('orderLink').value;
        navigator.clipboard.writeText(orderLink).then(() => {
            showAlert('success', '已复制到剪贴板');
            closeOrderLinkModal();
        }).catch(() => {
            showAlert('error', '复制失败');
        });
    }

    // 修改渲染购物车数据的函数，添加选择框
    function renderCartData(result) {
        const shopList = document.getElementById('shopList');
        shopList.innerHTML = '';
        selectedItems = []; // 重置选中的商品

        // 重置全选按钮状态
        const selectAllCheckbox = document.getElementById('selectAll');
        selectAllCheckbox.checked = false;

        if (!result.shops || result.shops.length === 0) {
            shopList.innerHTML = '<div class="empty-cart">购物车是空的</div>';
            return;
        }

        result.shops.forEach(shop => {
            const shopCard = document.createElement('div');
            shopCard.className = 'shop-card';

            // 店铺头部
            let shopHtml = `
                    <div class="shop-header">
                        <img src="${shop.shopLogo}" alt="${shop.shopName}" class="shop-logo">
                        <div class="shop-name">${shop.shopName}</div>
                    </div>
                `;

            // 遍历店铺分区
            shop.partitions.forEach(partition => {
                // 添加满减信息
                if (partition.cartPartitionActs) {
                    shopHtml += `
                            <div class="promotion-info">
                                ${partition.cartPartitionActs.actDecs}
                            </div>
                        `;
                }

                // 商品列表
                shopHtml += '<div class="item-list">';
                partition.itemList.forEach(item => {
                    const itemData = {
                        itemId: item.itemId,
                        skuId: item.skuId,
                        count: item.count
                    };

                    shopHtml += `
                            <div class="item-card">
                                <input type="checkbox" 
                                       class="item-checkbox" 
                                       data-item='${JSON.stringify(itemData)}'
                                       onchange="handleItemSelect(this)">
                                <img src="${item.itemImg}" alt="${item.itemName}" class="item-image">
                                <div class="item-info">
                                    <div class="item-name">${item.itemName}</div>
                                    ${item.skuName ? `<div class="item-sku">${item.skuName}</div>` : ''}
                                    <div class="item-price">
                                        ¥${item.price}
                                        ${item.oriPrice !== item.price ? `<span class="item-original-price">¥${item.oriPrice}</span>` : ''}
                                    </div>
                                    ${item.status === 3 ?
                        item.invalidReason === "未到销售时间" && item.itemDescs && item.itemDescs[0]?.futureTime ?
                            `<div class="item-status">
                                            <i class="ri-time-line"></i>
                                            ${new Date(item.itemDescs[0].futureTime * 1000).toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            })} 开售
                                        </div>` :
                            `<div class="item-status">${item.invalidReason}</div>`
                        : ''}
                                    <div class="item-count">数量：${item.count}</div>
                                </div>
                            </div>
                        `;
                });
                shopHtml += '</div>';
            });

            shopCard.innerHTML = shopHtml;
            shopList.appendChild(shopCard);
        });
    }

    // 显示提示信息
    function showAlert(type, message) {
        const alert = document.getElementById('customAlert');
        alert.className = `custom-alert ${type}`;
        alert.textContent = message;
        alert.classList.add('show');

        setTimeout(() => {
            alert.classList.remove('show');
        }, 2000);
    }

    // 添加区号输入验证
    document.getElementById('countryCode').addEventListener('input', function (e) {
        // 只允许输入数字
        this.value = this.value.replace(/\D/g, '');
        // 限制最大长度为5位
        if (this.value.length > 5) {
            this.value = this.value.slice(0, 5);
        }
    });

    // 更新切换账号按钮显示状态
    function updateSwitchAccountButton(show) {
        const switchAccountButton = document.getElementById('switchAccountButton');
        switchAccountButton.style.display = show ? 'flex' : 'none';
    }

    // 关闭所有模态框
    function closeAllModals() {
        closeLoginModal();
        closeOrderLinkModal();
        closeAccountSwitchModal();
    }

    // 显示账号切换模态框
    function showAccountSwitchModal() {
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('accountSwitchModal').style.display = 'block';
        renderAccountList();
    }

    // 关闭账号切换模态框
    function closeAccountSwitchModal() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('accountSwitchModal').style.display = 'none';
    }

    // 渲染账号列表
    function renderAccountList() {
        const accountList = document.getElementById('accountList');
        const savedAccounts = JSON.parse(localStorage.getItem('savedAccounts') || '[]');
        const currentCookie = localStorage.getItem('cartCookie');

        accountList.innerHTML = '';

        savedAccounts.forEach(account => {
            const isActive = account.cookie === currentCookie;
            const accountItem = document.createElement('div');
            accountItem.className = `account-item${isActive ? ' active' : ''}`;

            accountItem.innerHTML = `
                    <img src="${account.avatar || 'images/default-avatar.png'}" alt="${account.nickname}" class="account-avatar">
                    <div class="account-info">
                        <div class="account-name">${account.nickname || '未知用户'}</div>
                        <div class="account-phone">${account.phone || '未知手机号'}</div>
                    </div>
                    <div class="account-actions">
                        ${!isActive ? `
                            <button class="account-action-btn switch-btn" onclick="switchToAccount('${account.cookie}')">
                                <i class="ri-login-circle-line"></i>
                                切换
                            </button>
                        ` : ''}
                        <button class="account-action-btn delete-btn" onclick="deleteAccount('${account.cookie}')">
                            <i class="ri-delete-bin-line"></i>
                            删除
                        </button>
                    </div>
                `;

            accountList.appendChild(accountItem);
        });
    }

    // 切换到指定账号
    async function switchToAccount(cookie) {
        await handleLoginSuccess(cookie);
        closeAccountSwitchModal();
    }

    // 删除保存的账号
    function deleteAccount(cookie) {
        const savedAccounts = JSON.parse(localStorage.getItem('savedAccounts') || '[]');
        const updatedAccounts = savedAccounts.filter(account => account.cookie !== cookie);
        localStorage.setItem('savedAccounts', JSON.stringify(updatedAccounts));

        // 如果删除的是当前账号，则登出
        if (cookie === localStorage.getItem('cartCookie')) {
            handleLogout();
        }

        // 更新账号列表显示
        renderAccountList();
        // 更新切换账号按钮显示状态
        updateSwitchAccountButton(updatedAccounts.length > 0);
        showAlert('success', '账号已删除');
    }

    // 复制文本到剪贴板的通用函数
    function copyToClipboard(text) {
        // 优先使用现代 Clipboard API
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    showAlert('success', '已复制到剪贴板');
                })
                .catch(() => {
                    // 如果 Clipboard API 失败，回退到传统方法
                    fallbackCopyToClipboard(text);
                });
            return;
        }

        // 如果不支持 Clipboard API，使用传统方法
        fallbackCopyToClipboard(text);
    }

    // 传统的复制方法
    function fallbackCopyToClipboard(text) {
        // 创建临时输入框
        const textArea = document.createElement('textarea');
        textArea.value = text;

        // 设置样式使其不可见
        textArea.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 2em;
            height: 2em;
            padding: 0;
            border: none;
            outline: none;
            boxShadow: none;
            background: transparent;
            opacity: 0;
        `;

        document.body.appendChild(textArea);

        try {
            // 检查是否是iOS设备
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

            if (isIOS) {
                // iOS设备特殊处理
                const range = document.createRange();
                range.selectNodeContents(textArea);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                textArea.setSelectionRange(0, 999999);
            } else {
                // 其他设备
                textArea.select();
            }

            // 执行复制命令
            const successful = document.execCommand('copy');
            if (successful) {
                showAlert('success', '已复制到剪贴板');
            } else {
                showAlert('error', '复制失败，请手动复制');
            }
        } catch (err) {
            console.error('复制失败:', err);
            showAlert('error', '复制失败，请手动复制');
        } finally {
            // 清理临时元素
            document.body.removeChild(textArea);
        }
    }

    // 复制Cookie信息到剪贴板
    function copyCookieToClipboard() {
        const cookieText = document.getElementById('cookies').value;
        if (!cookieText) {
            showAlert('error', '没有可复制的Cookie信息');
            return;
        }
        copyToClipboard(cookieText);
    }

    // 复制订单数据
    function copyOrderData() {
        const orderDataInput = document.getElementById('orderDataInput');
        if (!orderDataInput.value) {
            showAlert('error', '没有可复制的订单数据');
            return;
        }
        copyToClipboard(orderDataInput.value);
    }
</script>
</body>
</html> 
